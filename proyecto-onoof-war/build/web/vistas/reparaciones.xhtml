<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:composition template="/templates/plantilla_principal.xhtml">
        <ui:define name="contenido">
            <h:form>
                <div class="flex justify-between items-center mb-2">
                    <p:commandButton value="Crear reparación" icon="pi pi-plus" 
                                     onclick="PF('crearReparacionDlg').show(); return false;" />

                    <!-- Campo de búsqueda para filtrar por cliente -->
                    <span class="ui-input-icon-left">
                        <i class="pi pi-search" />
                        <p:inputText placeholder="Buscar cliente" value="#{reparacionBean.busquedaCliente}">
                            <!-- Se realiza un update del datatable con la búsqueda -->
                            <p:ajax event="keyup" listener="#{reparacionBean.filtrarPorCliente}" update="reparacionesTable"/>
                        </p:inputText>
                    </span>
                </div>

                <div class="overflow-x-auto">
                    <p:dataTable id="reparacionesTable" value="#{reparacionBean.listaReparacionesFiltradas}" var="r"
                                 styleClass="min-w-full bg-white"
                                 rowStyleClass="even:bg-blue-50"
                                 paginator="true" rows="10">

                        <p:column headerText="Id" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <h:outputText value="#{r.id}" />
                        </p:column>

                        <p:column headerText="Cliente" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <h:outputText value="#{reparacionBean.getClienteNombre(r)}" />
                        </p:column>

                        <p:column headerText="Anticipo" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <h:outputText value="#{r.anticipo}">
                                <f:convertNumber pattern="$ #,##0.00" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Motivo de Reparación" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <h:outputText value="#{r.motivoReparacion}" />
                        </p:column>

                        <p:column headerText="Detalle" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <h:outputText value="#{r.detalle}" />
                        </p:column>

                        <p:column headerText="Fecha Ingreso" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <h:outputText value="#{r.fechaIngreso}">
                                <f:convertDateTime pattern="dd MMMM yyyy" locale="es" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Fecha Entrega" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <h:outputText value="#{r.fechaEntrega}">
                                <f:convertDateTime pattern="dd MMMM yyyy" locale="es" />
                            </h:outputText>
                        </p:column>


                        <p:column headerText="Estado" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <h:outputText value="#{reparacionBean.getEstadoNombre(r)}" />
                        </p:column>

                        <p:column headerText="Modelo" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <h:outputText value="#{reparacionBean.getModeloNombre(r)}" />
                        </p:column>

                        <p:column headerText="Acciones" styleClass="p-4 text-left text-sm font-medium text-slate-800">
                            <div class="flex items-center">
                                <p:commandButton icon="pi pi-pencil" 
                                                 title="Editar"
                                                 actionListener="#{reparacionBean.editar(r)}"
                                                 update="@form" 
                                                 style="margin-right: .5rem;" />
                                <p:commandButton type="button"
                                                 title="Eliminar"
                                                 icon="pi pi-times" 
                                                 styleClass="ui-button-danger" 
                                                 actionListener="#{reparacionBean.eliminar(r)}"
                                                 update="@form" />
                            </div>
                        </p:column>

                    </p:dataTable>
                </div>
            </h:form>

            <!-- Modal (Dialog) de crear reparación -->
            <p:dialog id="crearReparacionDialog" header="Crear Nueva Reparación" widgetVar="crearReparacionDlg" modal="true" showEffect="fade" hideEffect="fade">
                <h:form>
                    <div class="space-y-6 mt-8">
                        <div>
                            <h:outputLabel for="nombreProducto" value="Nombre del producto" />
                            <p:inputText id="nombreProducto" placeholder="Ingrese el nombre del producto" styleClass="px-4 py-3 bg-gray-100 w-full text-slate-900 text-sm border-none focus:outline-blue-600 focus:bg-transparent rounded-lg"/>
                        </div>

                        <div>
                            <h:outputLabel for="descripcionProducto" value="Descripción" />
                            <p:inputTextarea id="descripcionProducto" placeholder="Escriba acerca del producto" styleClass="px-4 py-3 bg-gray-100 w-full text-slate-900 text-sm border-none focus:outline-blue-600 focus:bg-transparent rounded-lg" rows="3"/>
                        </div>

                        <div>
                            <h:outputLabel for="cantidadProducto" value="Cantidad" />
                            <p:inputText id="cantidadProducto" placeholder="Ingrese la cantidad" styleClass="px-4 py-3 bg-gray-100 w-full text-slate-900 text-sm border-none focus:outline-blue-600 focus:bg-transparent rounded-lg"/>
                        </div>

                        <div>
                            <h:outputLabel for="precioProducto" value="Precio de venta" />
                            <p:inputText id="precioProducto" placeholder="Ingrese el precio" styleClass="px-4 py-3 bg-gray-100 w-full text-slate-900 text-sm border-none focus:outline-blue-600 focus:bg-transparent rounded-lg"/>
                        </div>

                        <div>
                            <h:outputLabel for="categoriaProducto" value="Categoría" />
                            <p:inputText id="categoriaProducto" placeholder="Ingrese la categoría" styleClass="px-4 py-3 bg-gray-100 w-full text-slate-900 text-sm border-none focus:outline-blue-600 focus:bg-transparent rounded-lg"/>
                        </div>

                        <div class="flex justify-end gap-4 mt-8">
                            <p:commandButton value="Cancelar" onclick="PF('crearReparacionDlg').hide()" class="px-6 py-3 rounded-lg text-slate-900 text-sm font-medium border-none outline-none tracking-wide bg-gray-200 hover:bg-gray-300"/>
                            <p:commandButton value="Crear" actionListener="#{reparacionBean.crearReparacion}" class="px-6 py-3 rounded-lg text-white text-sm font-medium border-none outline-none tracking-wide bg-blue-600 hover:bg-blue-700"/>
                        </div>
                    </div>
                </h:form>
            </p:dialog>

        </ui:define>
    </ui:composition>
</html>